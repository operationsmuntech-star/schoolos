{% extends 'base.html' %}
{% load static %}

{% block title %}Admin Analytics{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="h4 mb-3">Admin Analytics</h1>
    <div class="row">
        <div class="col-md-8 mb-4">
            <div class="card">
                <div class="card-body">
                    <canvas id="enrollmentChart" height="120"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-4">
            <div class="card p-3 text-center">
                <h6>Attendance (This Month)</h6>
                <h2 id="attendance-pct">{{ attendance_percentage }}%</h2>
            </div>
            <div class="card mt-3 p-3">
                <h6>Revenue (Last 6 months)</h6>
                <canvas id="revenueChart" height="120"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const labels = {{ labels|safe }};
const enrolled = {{ enrolled_counts|safe }};
const revenue = {{ revenue|safe }};

const ctx = document.getElementById('enrollmentChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'New Enrollments',
            data: enrolled,
            borderColor: '#0d6efd',
            backgroundColor: 'rgba(13,110,253,0.1)',
            fill: true
        }]
    },
    options: { responsive: true }
});

const ctx2 = document.getElementById('revenueChart').getContext('2d');
new Chart(ctx2, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Fees Collected',
            data: revenue,
            backgroundColor: '#198754'
        }]
    },
    options: { responsive: true }
});
</script>
{% endblock %}